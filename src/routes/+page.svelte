<script lang="ts">
	import { goto } from '$app/navigation';
	import Button from '$lib/components/Button.svelte';
	import '../app.css';

	let username = '';
	let password = '';
	let error = '';

	async function handleLogin() {
		const resp = await fetch(`/api/auth/login`, {
			method: 'POST',
			headers: {
				'Content-Type': 'application/json'
			},
			body: JSON.stringify({
				username,
				password
			})
		});
		const data = await resp.json();
		if (!data.success) {
			error = 'Erro ao fazer login';
			return;
		}
		if (data.message === 'INVALID_CREDENTIALS') {
			error = 'Credenciais inválidas';
			return;
		}

		if (data.message === 'UNAUTHORIZED') {
			error = 'Você não tem permissão para acessar essa página';
			return;
		}
		goto('/admin');
	}
  


</script>

<div class="flex flex-col justify-center items-center h-screen w-screen">
	<h1 class="text-primary text-2xl font-semibold text-center mb-6">GATTO ROSA ADMIN</h1>
	
	<div>
		<form class="rounded flex flex-col gap-4">
			<div class="h-4">
				{#if error}
					<p class="text-red-500 text-center w-full">{error}</p>
				{/if}
			</div>
			<label class="text-sm decoration-sky-500" for="login">Login</label>
			<input class="border border-gray-500 rounded-md p-1" name="login" bind:value={username} />
			<label class="text-sm decoration-sku-500" for="password">Senha</label>
			<input
				class="border border-gray-500 rounded-md p-1"
				name="password"
				type="password"
				bind:value={password}
			/>
			<Button on:click={handleLogin} name="Login" block={true}>Login</Button>
		</form>
	</div>
</div>
